<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Identify significantly different interactions across groups with replicate samples â€¢ celltalker</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Identify significantly different interactions across groups with replicate samples">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">celltalker</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.7.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/celltalker.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/consistent_interactions.html">Identify significantly different interactions across groups with replicate samples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="consistent_interactions_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Identify significantly different interactions across groups with replicate samples</h1>
                        <h4 class="author">Anthony R Cillo</h4>
            
            <h4 class="date">05 May, 2022</h4>
      
      
      <div class="hidden name"><code>consistent_interactions.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates an extension of the core functionality of celltalker to replicate samples. The idea is that this functionality can be used to identify consistently differentially expressed ligand and receptor interactions. To demonstrate this functionality, we will leverage our <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE139324">previously published</a> dataset of healthy donor PBMC and healthy donor tonsils.</p>
<p>The data preprocessing steps are documented in the data-raw directory. We will start with a low-dimensional visualization with annotated cell types.</p>
<div id="load-packages-and-setup-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#load-packages-and-setup-analysis" class="anchor"></a>Load packages and setup analysis</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>({</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(celltalker)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Seurat)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Load data provided with package</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"filtered_lig_rec"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"overall_metadata"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"overall_umap"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Create a Seurat object based on 5 healthy donor PBMC and 5 healhy donor tonsils</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>ser_obj <span class="ot">&lt;-</span> <span class="fu">CreateSeuratObject</span>(filtered_lig_rec,<span class="at">meta.data=</span>overall_metadata)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>ser_obj[[<span class="st">"umap"</span>]] <span class="ot">&lt;-</span> <span class="fu">CreateDimReducObject</span>(<span class="at">embeddings =</span> overall_umap, <span class="at">key =</span> <span class="st">"UMAP_"</span>, <span class="at">assay =</span> <span class="fu">DefaultAssay</span>(ser_obj))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(ser_obj,<span class="at">group.by=</span><span class="st">"cell_types"</span>,<span class="at">split.by=</span><span class="st">"sample_type"</span>)</span></code></pre></div>
<p><img src="consistent_interactions_files/figure-html/setup-1.png" width="700"></p>
</div>
<div id="run-celltalker" class="section level2">
<h2 class="hasAnchor">
<a href="#run-celltalker" class="anchor"></a>Run celltalker</h2>
<p>Next, we will split the data into PBMC and Tonsil Seurat objects and will identify the top ligand and receptor interactions in each of these datasets</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Split dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ser_split <span class="ot">&lt;-</span> <span class="fu">SplitObject</span>(ser_obj,<span class="at">split=</span><span class="st">"sample_type"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Check out the split data</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>ser_split</span></code></pre></div>
<pre><code>## $PBMC
## An object of class Seurat 
## 204 features across 10836 samples within 1 assay 
## Active assay: RNA (204 features, 0 variable features)
##  1 dimensional reduction calculated: umap
## 
## $Tonsil
## An object of class Seurat 
## 204 features across 12898 samples within 1 assay 
## Active assay: RNA (204 features, 0 variable features)
##  1 dimensional reduction calculated: umap</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Run celltalker - PBMC</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>pbmc_interactions <span class="ot">&lt;-</span> <span class="fu">celltalk</span>(<span class="at">input_object=</span>ser_split[[<span class="st">"PBMC"</span>]],</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">metadata_grouping=</span><span class="st">"cell_types"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ligand_receptor_pairs=</span>ramilowski_pairs,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">number_cells_required=</span><span class="dv">50</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_expression=</span><span class="dv">50</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_expression=</span><span class="dv">20000</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scramble_times=</span><span class="dv">10</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Check out the interactions - PBMC</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>pbmc_interactions <span class="sc">%&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_val_adj=</span><span class="fu">p.adjust</span>(p_val,<span class="at">method=</span><span class="st">"fdr"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_val_adj<span class="sc">&lt;</span><span class="fl">0.05</span>)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by 'cli':
##   method     from    
##   print.boxx spatstat</code></pre>
<pre><code>## # A tibble: 49 x 10
##    interaction_paiâ€¦ interaction value scram_mean scram_sd   p_val cell_type1
##    &lt;chr&gt;            &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     
##  1 CD14+CD16- monoâ€¦ ADAM17_ITGâ€¦ 0.459     0.275    0.0373 4.40e-7 CD14+CD16â€¦
##  2 CD1C+ DCs_CD14+â€¦ ADAM28_ITGâ€¦ 0.258     0.131    0.0294 7.75e-6 CD1C+ DCs 
##  3 B cells_CD1C+ Dâ€¦ ADAM28_ITGâ€¦ 0.414     0.152    0.0444 1.82e-9 B cells   
##  4 CD14-CD16+ monoâ€¦ BTLA_CD247  0.824     0.204    0.139  3.92e-6 CD14-CD16â€¦
##  5 CD14+CD16- monoâ€¦ BTLA_TNFRSâ€¦ 0.293     0.200    0.0208 4.48e-6 CD14+CD16â€¦
##  6 CD8 T cells_CD8â€¦ CALR_HLA-F  0.717     0.474    0.0726 4.06e-4 CD8 T celâ€¦
##  7 CD8 T cells_CD4â€¦ CCL5_CXCR3  1.12      0.0936   0.0281 0.      CD8 T celâ€¦
##  8 CD14+CD16- monoâ€¦ CD14_ITGA4  0.854     0.183    0.0805 0.      CD14+CD16â€¦
##  9 CD14+CD16- monoâ€¦ CD14_ITGA4  0.914     0.199    0.0814 0.      CD14+CD16â€¦
## 10 CD14+CD16- monoâ€¦ CD14_ITGA4  0.945     0.196    0.0754 0.      CD14+CD16â€¦
## # â€¦ with 39 more rows, and 3 more variables: cell_type2 &lt;chr&gt;,
## #   interact_ratio &lt;dbl&gt;, p_val_adj &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Run celltalker - Tonsil</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>tonsil_interactions <span class="ot">&lt;-</span> <span class="fu">celltalk</span>(<span class="at">input_object=</span>ser_split[[<span class="st">"Tonsil"</span>]],</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">metadata_grouping=</span><span class="st">"cell_types"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ligand_receptor_pairs=</span>ramilowski_pairs,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">number_cells_required=</span><span class="dv">50</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_expression=</span><span class="dv">50</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_expression=</span><span class="dv">20000</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scramble_times=</span><span class="dv">10</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Check out the interactions - tonsil</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>tonsil_interactions <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_val_adj=</span><span class="fu">p.adjust</span>(p_val,<span class="at">method=</span><span class="st">"fdr"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_val_adj<span class="sc">&lt;</span><span class="fl">0.05</span>)</span></code></pre></div>
<pre><code>## # A tibble: 50 x 10
##    interaction_paiâ€¦ interaction value scram_mean scram_sd   p_val cell_type1
##    &lt;chr&gt;            &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     
##  1 B cells_CD1C+ Dâ€¦ ADAM28_ITGâ€¦ 0.428     0.166    0.0681 6.03e-5 B cells   
##  2 CD1C+ DCs_NK ceâ€¦ CALR_HLA-F  1.12      0.800    0.0815 4.58e-5 CD1C+ DCs 
##  3 CD1C+ DCs_NK ceâ€¦ CD14_ITGA4  0.413     0.125    0.0611 1.17e-6 CD1C+ DCs 
##  4 CD1C+ DCs_CD1C+â€¦ CD14_ITGA4  0.339     0.0942   0.0541 3.12e-6 CD1C+ DCs 
##  5 CD1C+ DCs_CD1C+â€¦ CD14_ITGB1  0.450     0.217    0.0493 1.22e-6 CD1C+ DCs 
##  6 CD4 T cells_B câ€¦ CD40LG_CD40 0.643     0.299    0.106  5.77e-4 CD4 T celâ€¦
##  7 CD4 T cells_B câ€¦ CD40LG_ITGâ€¦ 0.286     0.0220   0.0164 0.      CD4 T celâ€¦
##  8 CD4 T cells_Plaâ€¦ CD40LG_ITGâ€¦ 0.277     0.0229   0.0156 0.      CD4 T celâ€¦
##  9 CD4 T cells_CD1â€¦ CD40LG_ITGâ€¦ 0.304     0.0522   0.0805 8.88e-4 CD4 T celâ€¦
## 10 CD4 T cells_CD4â€¦ CD40LG_TRAâ€¦ 0.319     0.0601   0.0138 0.      CD4 T celâ€¦
## # â€¦ with 40 more rows, and 3 more variables: cell_type2 &lt;chr&gt;,
## #   interact_ratio &lt;dbl&gt;, p_val_adj &lt;dbl&gt;</code></pre>
</div>
<div id="create-circos-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#create-circos-plots" class="anchor"></a>Create circos plots</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot top 3 interactions - PBMC</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the top 3 interactions for cell_type1</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>top_stats_pbmc <span class="ot">&lt;-</span> pbmc_interactions <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_val_adj=</span><span class="fu">p.adjust</span>(p_val,<span class="at">method=</span><span class="st">"fdr"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_val_adj<span class="sc">&lt;</span><span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cell_type1) <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">10</span>,interact_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign colors to cell types</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>all_cell_types <span class="ot">&lt;-</span> <span class="fu">unique</span>(ser_obj[[<span class="st">"cell_types"</span>]][,<span class="dv">1</span>])</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>colors_use <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n=</span><span class="dv">8</span>,<span class="st">"Set2"</span>))(<span class="fu">length</span>(all_cell_types))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(colors_use) <span class="ot">&lt;-</span> all_cell_types</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress messages to silence the circlize functions</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="fu">circos_plot</span>(<span class="at">ligand_receptor_frame=</span>top_stats_pbmc,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">cell_group_colors=</span>colors_use,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">ligand_color=</span><span class="st">"blue"</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">receptor_color=</span><span class="st">"red"</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex_outer=</span><span class="fl">0.5</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex_inner=</span><span class="fl">0.4</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="consistent_interactions_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot top 3 interactions - Tonsil</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the top 3 interactions for cell_type1</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>top_stats_tonsil <span class="ot">&lt;-</span> tonsil_interactions <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_val_adj=</span><span class="fu">p.adjust</span>(p_val,<span class="at">method=</span><span class="st">"fdr"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_val_adj<span class="sc">&lt;</span><span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cell_type1) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">10</span>,interact_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress messages to silence the circlize functions</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">circos_plot</span>(<span class="at">ligand_receptor_frame=</span>top_stats_tonsil,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cell_group_colors=</span>colors_use,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ligand_color=</span><span class="st">"blue"</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">receptor_color=</span><span class="st">"red"</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex_outer=</span><span class="fl">0.5</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex_inner=</span><span class="fl">0.4</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="consistent_interactions_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
</div>
<div id="identify-significantly-different-interactions-across-patient-samples" class="section level2">
<h2 class="hasAnchor">
<a href="#identify-significantly-different-interactions-across-patient-samples" class="anchor"></a>Identify significantly different interactions across patient samples</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Comparison of group interactions</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use top 10 interactions from tonsils as input</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>group_stats <span class="ot">&lt;-</span> <span class="fu">compare_group_interactions</span>(<span class="at">seurat_object=</span>ser_obj,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">interaction_stats=</span>top_stats_tonsil,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_replicates=</span><span class="st">"sample_id"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_groups=</span><span class="st">"sample_type"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metadata_grouping=</span><span class="st">"cell_types"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract p values into data.frame and add FDR</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>mod_p_vals <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(group_stats,<span class="cf">function</span>(x) {</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">class</span>(x) <span class="sc">!=</span> <span class="st">"lm"</span>) <span class="fu">stop</span>(<span class="st">"Not an object of class 'lm' "</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> <span class="fu">summary</span>(x)<span class="sc">$</span>fstatistic</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">pf</span>(f[<span class="dv">1</span>],f[<span class="dv">2</span>],f[<span class="dv">3</span>],<span class="at">lower.tail=</span>F)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">attributes</span>(p) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>mod_p_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(mod_p_vals,<span class="at">p_val_adj=</span><span class="fu">p.adjust</span>(mod_p_vals[,<span class="dv">1</span>],<span class="at">method=</span><span class="st">"fdr"</span>))</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>mod_p_vals</span></code></pre></div>
<pre><code>##                                            mod_p_vals    p_val_adj
## B cells_ADAM28_CD1C+ DCs_ITGA4           5.287926e-01 0.6624456605
## B cells_PTDSS1_CD8 T cells_JMJD6         2.497048e-01 0.3706388400
## CD1C+ DCs_CD14_CD1C+ DCs_ITGA4           8.455559e-01 0.9248267968
## CD1C+ DCs_ICAM1_B cells_IL2RA            3.715232e-02 0.0812706980
## CD1C+ DCs_ICAM1_CD1C+ DCs_ITGAX          5.266535e-01 0.6624456605
## CD1C+ DCs_ICAM1_CD4 T cells_IL2RA        4.203750e-02 0.0846563895
## CD1C+ DCs_ICAM1_NK cells_IL2RA           3.378335e-03 0.0090955171
## CD1C+ DCs_ICAM1_NK cells_ITGAL           8.902670e-01 0.9422707383
## CD1C+ DCs_LYZ_B cells_ITGAL              2.541523e-01 0.3706388400
## CD1C+ DCs_LYZ_NK cells_ITGAL             8.350392e-02 0.1461318650
## CD1C+ DCs_TNFSF12_B cells_TNFRSF25       1.295997e-01 0.2159995750
## CD1C+ DCs_TNFSF13B_Plasmablasts_TNFRSF17 5.299565e-01 0.6624456605
## CD4 T cells_CD40LG_B cells_CD40          1.716823e-03 0.0054626178
## CD4 T cells_CD40LG_B cells_ITGAM         3.051935e-03 0.0089014766
## CD4 T cells_CD40LG_CD1C+ DCs_ITGAM       1.087969e-03 0.0038078921
## CD4 T cells_CD40LG_CD4 T cells_TRAF3     9.402560e-05 0.0008592326
## CD4 T cells_CD40LG_Plasmablasts_ITGAM    2.182434e-04 0.0010745505
## CD4 T cells_IL23A_NK cells_IL12RB1       9.832068e-01 0.9832068431
## CD4 T cells_SEMA4D_B cells_CD72          7.343167e-01 0.8290672535
## CD4 T cells_TNF_CD1C+ DCs_TNFRSF1B       9.153487e-01 0.9422707383
## CD8 T cells_IL16_CD1C+ DCs_CD4           1.560372e-02 0.0390093124
## CD8 T cells_SEMA4D_B cells_CD72          6.930776e-01 0.8085905084
## CD8 T cells_TNF_CD1C+ DCs_TNFRSF1A       3.630891e-01 0.5083247269
## NK cells_GZMB_CD1C+ DCs_PGRMC1           2.616099e-04 0.0010745505
## NK cells_GZMB_CD8 T cells_IGF2R          2.648074e-04 0.0010745505
## NK cells_GZMB_NK cells_IGF2R             2.763130e-04 0.0010745505
## NK cells_LTA_CD1C+ DCs_TNFRSF1A          3.348573e-02 0.0781333685
## NK cells_LTA_CD1C+ DCs_TNFRSF1B          4.353757e-02 0.0846563895
## NK cells_LY86_B cells_CD180              7.454519e-02 0.1373200843
## NK cells_PSEN1_CD1C+ DCs_NCSTN           2.361371e-01 0.3706388400
## NK cells_SPON2_CD4 T cells_ITGAM         9.147412e-05 0.0008592326
## NK cells_SPON2_NK cells_ITGAM            6.781877e-05 0.0008592326
## NK cells_SPON2_Plasmablasts_ITGAM        9.819802e-05 0.0008592326
## Plasmablasts_HSP90B1_NK cells_TLR1       5.827913e-01 0.7033688365
## Plasmablasts_TNFSF12_NK cells_TNFRSF25   1.699910e-04 0.0010745505</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of joint weight interaction across replicates</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot_group_interaction</span>(<span class="at">seurat_object=</span>ser_obj,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">interaction_stats=</span>top_stats_tonsil,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_replicates=</span><span class="st">"sample_id"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_groups=</span><span class="st">"sample_type"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">metadata_grouping=</span><span class="st">"cell_types"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ligand=</span><span class="st">"CD40LG"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">receptor=</span><span class="st">"CD40"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">cell_type1=</span><span class="st">"CD4 T cells"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cell_type2=</span><span class="st">"B cells"</span>)</span></code></pre></div>
<p><img src="consistent_interactions_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-packages-and-setup-analysis">Load packages and setup analysis</a></li>
      <li><a href="#run-celltalker">Run celltalker</a></li>
      <li><a href="#create-circos-plots">Create circos plots</a></li>
      <li><a href="#identify-significantly-different-interactions-across-patient-samples">Identify significantly different interactions across patient samples</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Anthony Cillo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
